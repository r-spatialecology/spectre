---
title: "BCI forest8 data: dataset description"
author: ""
date: "7/5/2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{BCI forest8 data: dataset description}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Description of test data set(s)
To test the spectre algorithm(s), we used data from the BCI.  

```{r, include = FALSE,echo=FALSE}
library(spectre)
data <- bci.tree8
data[1:10, 1:10]
```

## Sites and species, data structure



```{r, include = TRUE, echo=FALSE}
dim(data)
n_species <- dim(data)[1]
n_sites <- dim(data)[2]
# richness per site
alpha_list <- colSums(data)
# gamma diversity
total_gamma <- sum(rowSums(data) > 0)


```
The dataset includes occurences of `r n_species` tree species across `r n_sites` sites, each site is 20 x 20m. Tree species in rows, sites in columns. 

Gamma diversity is `r total_gamma`, mean richness per site is `r round(mean(alpha_list),1) `, 1 SD = `r round(sd(alpha_list),1)`. The average richness is `r round(mean(alpha_list) / total_gamma * 100, 1)` % of gamma diversity.

```{r, include = TRUE, echo=FALSE}

data[1:5, 1:8]

plot(  1:length(alpha_list) , alpha_list, ylim = c(0, total_gamma + 1),
      xlab = "Site", ylab = "Richness", main = "Blue = gamma-diversity, red = mean(richness)")
abline(h = total_gamma, lty = "dotted", lwd = 2, col = "blue")
abline(h = mean(alpha_list), col = "red", lty = 2)
```

## Rare vs. common species
Roughly 60 out of `r n_species` tree species (`r round(60/n_species * 100, 2)  ` %) occur at > 50% of all sites. 

```{r, include = TRUE, echo=FALSE}
# produce abundance per species plot, in ranked order (high to low)
sites_per_species <- rowSums(data)
plot (sort(sites_per_species,  decreasing = TRUE), xlab = "species, sorted by occupied number of sites", ylab = "occurance at n sites")
abline(h = n_sites / 2, lty = 2, col = "blue")
abline(v = 60, col = "blue", lty = 2)
```


## Commonness matrix


```{r, include = TRUE, echo=FALSE}
library(viridisLite)

viridis_colours <- viridis(3)[3:1]
plot_commonness_explore <- function(commonness_explore) {
  
  # commonness_explore <- calculate_solution_commonness_rcpp(species_grid[[1]])
  
  n_row <- nrow(commonness_explore)
  n_col <- ncol(commonness_explore)
  
  #commonness_explore[upper.tri(commonness_explore, diag = TRUE)] <- NA
  
  commonness_difference_grid <- commonness_explore 
  
  commonness_difference <- expand.grid(x = seq_len(n_row), 
                                       y = seq_len(n_col))
  
  commonness_difference$value <- commonness_difference_grid[seq_len(n_row * n_col)]
  
  plot <- ggplot2::ggplot(data = commonness_difference) + 
    ggplot2::geom_raster(ggplot2::aes(x = x, y = y, fill = value)) + 
    ggplot2::scale_fill_gradientn(name = "Commonness", 
                                  colours = c(viridis_colours)) + 
    ggplot2::coord_equal() + 
    ggplot2::labs(title = "Commonness matrix", x = "Site ID", y = "Site ID")+
    ggplot2::theme_void()
  
  return(plot)
}
commonness_explore <- as.matrix(spectre:::calculate_solution_commonness_rcpp(data))
plot_commonness_explore(commonness_explore)

```

If (small) random subsamples are used for testing, compared to bird data, in the BCI data there are less siteXsite pairs that have no species in common. However, due to subsampling, by chance a target commonness matrix with a total commonness == 0 could happen. 