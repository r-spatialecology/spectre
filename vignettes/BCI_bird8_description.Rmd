---
title: "BCI forest8 data: dataset description"
author: ""
date: "7/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Description of test data set(s)
To test the spectre algorithm(s), we used data from the BCI.  

```{r, include = FALSE,echo=FALSE}
data <- readRDS("~/spectre/data/BCI_tree8_MSP.rds")
data[1:10, 1:10]
```

## Sites and species, data structure



```{r, include = TRUE, echo=FALSE}
# richness per site
alpha_list <- rowSums(data)
# gamma diversity
total_gamma <- sum(colSums(data) > 0)


```
The dataset includes occurences of tree species across `r dim(data)[1]` plots, each plot is 20 x 20m. Tree species in columns, plots rowwise. (*spectre* expects input data the other way around, thus data has to be transposed later... ). 

Gamma diversity is `r total_gamma`, mean richness per site is `r round(mean(alpha_list),1) `, 1 SD = `r round(sd(alpha_list),1)`. The average richness is `r round(mean(alpha_list) / total_gamma * 100, 1)` % of gamma diversity.

```{r, include = TRUE, echo=FALSE}

data[1:5, 1:8]

plot( 1:length(alpha_list), alpha_list, ylim = c(0, total_gamma + 1),
      xlab = "Site", ylab = "Richness", main = "Blue = gamma-diversity, red = mean(richness)")
abline(h = total_gamma, lty = "dotted", lwd = 2, col = "blue")
abline(h = mean(alpha_list), col = "red", lty = 2)
```

## Commonness matrix

```{r, include = TRUE, echo=FALSE}
library(viridis)
library(viridisLite)
viridis_colours <- viridis(3)[3:1]
plot_commonness_explore <- function(commonness_explore) {
  
  # commonness_explore <- calculate_solution_commonness_rcpp(species_grid[[1]])
  
  n_row <- nrow(commonness_explore)
  n_col <- ncol(commonness_explore)
  
  #commonness_explore[upper.tri(commonness_explore, diag = TRUE)] <- NA
  
  commonness_difference_grid <- commonness_explore 
  
  commonness_difference <- expand.grid(x = seq_len(n_row), 
                                       y = seq_len(n_col))
  
  commonness_difference$value <- commonness_difference_grid[seq_len(n_row * n_col)]
  
  plot <- ggplot2::ggplot(data = commonness_difference) + 
    ggplot2::geom_raster(ggplot2::aes(x = x, y = y, fill = value)) + 
    ggplot2::scale_fill_gradientn(name = "Commonness", 
                                  colours = c(viridis_colours)) + 
    ggplot2::coord_equal() + 
    ggplot2::labs(title = "Commonness matrix", x = "Site ID", y = "Site ID")+
    ggplot2::theme_void()
  
  return(plot)
}
commonness_explore <- as.matrix(spectre:::calculate_solution_commonness_rcpp(data))
plot_commonness_explore(commonness_explore)

```

If (small) random subsamples are used for testing, compared to bird data, in the BCI data there are less siteXsite pairs that have no species in common. However, due to subsampling, by chance a target commonness matrix with a total commonness == 0 could happen. 